name: ðŸš€ Release Please

on:
    push:
        branches:
            - 43-feature-add-release-notes

permissions:
    contents: write
    pull-requests: write

jobs:
    release:
        runs-on: ubuntu-latest
        steps:
            - name: ðŸ¤– Release Please
              id: rp
              uses: googleapis/release-please-action@v4
              with:
                  # If you want other workflows to trigger on the release PR merge/tag,
                  # use a PAT. Otherwise GITHUB_TOKEN is fine.
                  token: ${{ secrets.GITHUB_TOKEN }}
                  config-file: release-please-config.json
                  manifest-file: .release-please-manifest.json
                  target-branch: 43-feature-add-release-notes

            # Optional: mark the release PR as "published" when a release is created
        #   - name: âœ… Mark release PR as published
        #     if: ${{ steps.rp.outputs.release_created }}
        #     uses: actions/github-script@v7
        #     with:
        #       github-token: ${{ secrets.GH_PAT || secrets.GITHUB_TOKEN }}
        #       script: |
        #         const tag = `${{ steps.rp.outputs.tag_name }}`;

        #         // Find the most recent merged "release" PR created by release-please
        #         const prs = await github.paginate(github.rest.pulls.list, {
        #           owner: context.repo.owner,
        #           repo: context.repo.repo,
        #           state: "closed",
        #           per_page: 50
        #         });

        #         const pr = prs.find(p =>
        #           p.merged_at &&
        #           (p.user?.login === "release-please[bot]" || p.user?.login === "github-actions[bot]") &&
        #           (p.labels || []).some(l => (l.name || "").startsWith("autorelease:"))
        #         );

        #         if (!pr) return;

        #         await github.rest.issues.addLabels({
        #           owner: context.repo.owner,
        #           repo: context.repo.repo,
        #           issue_number: pr.number,
        #           labels: ["autorelease: published"]
        #         });

        #         await github.rest.issues.createComment({
        #           owner: context.repo.owner,
        #           repo: context.repo.repo,
        #           issue_number: pr.number,
        #           body: `âœ… Released in **${tag}** ðŸŽ‰`
        #         });
